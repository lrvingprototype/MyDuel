<!DOCTYPE html>
<head>

</head>
<style>
    body{
        background-color: rgb(45, 47, 48);
    }
    .container {
        align-items: center;
        display: flex;
        justify-content: space-between;
    }
    .player1 {
        background-color: lightblue;
        width: 48%;display: flex;justify-content: space-between;
    }
    .player2 {
        background-color: lightcoral;
        width: 48%;display: flex;justify-content: space-between;
    }
    .calcurator{
        width:50%;
    }
    .LP{
        width:50%;
        background-color: rgba(204, 204, 204, 0.645);
        color:rgb(0, 0, 0);
        vertical-align: middle;
        font-size: 30px;
    }
    .LP:first-child{
        text-align: left;
    }
    .LP:last-child{
        text-align: right;
    }
</style>
<body>
    <div class="container">
        <div class="player1">

            <table class="calculator">

                <tr>
                    <td><button onclick="AddNumber_1(7)"> 7 </button></td>
                    <td><button onclick="AddNumber_1(8)"> 8 </button></td>
                    <td><button onclick="AddNumber_1(9)"> 9 </button></td>
                    <td><button onclick="changeOperator_1('+')"id="plus_1">+</button></td>
                </tr>
                <tr>
                    <td><button onclick="AddNumber_1(4)"> 4 </button></td>
                    <td><button onclick="AddNumber_1(5)"> 5 </button></td>
                    <td><button onclick="AddNumber_1(6)"> 6 </button></td>
                    <td><button onclick="changeOperator_1('-')" id="minus_1">-</button></td>
                </tr>
                <tr>
                    <td><button onclick="AddNumber_1(1)"> 1 </button></td>
                    <td><button onclick="AddNumber_1(2)"> 2 </button></td>
                    <td><button onclick="AddNumber_1(3)"> 3 </button></td>
                    <td><button onclick="Half_1()">/2</button></td>
                </tr>
                <tr>
                    <td><button onclick="AddNumber_1(0)">  0</button></td>
                    <td><button onclick="AddZero_1(2)"> 00</button></td>
                    <td><button onclick="AddZero_1(3)">000</button></td>
                    <td><button onclick="sendData_1()">=</button></td>

                </tr>
            </table>
            <p class="LP" id="player_1">8000</p>
        </div>
        <div class="player2">
            <p class="LP" id="player_2">7000</p>
            <table>
            <tr>
                <td><button onclick="AddNumber_2(7)"> 7 </button></td>
                <td><button onclick="AddNumber_2(8)"> 8 </button></td>
                <td><button onclick="AddNumber_2(9)"> 9 </button></td>
                <td><button onclick="changeOperator_2('+')" id="plus_2">+</button></td>
            </tr>
            <tr>
                <td><button onclick="AddNumber_2(4)"> 4 </button></td>
                <td><button onclick="AddNumber_2(5)"> 5 </button></td>
                <td><button onclick="AddNumber_2(6)"> 6 </button></td>
                <td><button onclick="changeOperator_2('-')" id="minus_2">-</button></td>
            </tr>
            <tr>
                <td><button onclick="AddNumber_2(1)"> 1 </button></td>
                <td><button onclick="AddNumber_2(2)"> 2 </button></td>
                <td><button onclick="AddNumber_2(3)"> 3 </button></td>
                <td><button onclick="Half_2()">/2</button></td>
            </tr>
            <tr>
                <td><button onclick="AddNumber_2(0)">  0</button></td>
                <td><button onclick="AddZero_2(2)"> 00</button></td>
                <td><button onclick="AddZero_2(3)">000</button></td>
                <td><button onclick="sendData_2()">=</button></td>
        
            </tr>
        </table>
        </div>
    </div>
    <div class="container">
        <div class="player1">
            <p >未実装</p>
        </div>
        <div class="player2">
            <p >未実装</p>
        </div>
    </div>

    <script type="text/javascript">

        let LP1=8000;
        let LP2=8000;        
        let p1=0;
        let p2=0;
        let o1='-'
        let o2='-'

        let d1=0;
        let d2=0;
        let c1=true;
        let c2=true;

//        const ws= new WebSocket('ws://localhost:3000');
        const ws = new WebSocket('https://myduel.onrender.com/');

        ws.onmessage = function(event) {
            console.log(event.data);
            
            const data = JSON.parse(event.data);

            if (data.type === 'player') {
                console.log(data)
                if(data.playerData.id===1){
                    playerData=data.playerData
                    console.log("player1のデータ")
                    LP1=playerData.LP;
                    c1=playerData.coin;
                    d1=playerData.dice;

                    o1="-"
                    p1=0;
                    
                    Update_1()
                }
                if(data.playerData.id===2){
                    playerData=data.playerData
                    console.log("player2のデータ")
                    LP2=playerData.LP;
                    c2=playerData.coin;
                    d2=playerData.dice;
                    
                    o2="-"
                    p2=0;
                    Update_2()
                }
            }
        };

        function AddNumber_1(num){
            p1=p1*10+num;
            Update_1()
        }
        function AddZero_1(num){
            for(i=0;i<num;i++){
                AddNumber_1(0);
            }
            
        }
        function AddZero_2(num){
            for(i=0;i<num;i++){
                AddNumber_2(0);
            }
            
        }
        function AddNumber_2(num){
            p2=p2*10+num;
            Update_2()
        }
        function Half_1(){

            o1='-'
            p1=Math.floor(LP1/2);
            Update_1()
        }
        function Half_2(){
            o2='-'
            p2=Math.floor(LP2/2);
            Update_2()
        }
        function changeOperator_1(ope){
            o1=ope
            Update_1()
        }
        function changeOperatorMinus_1(ope){
            o1="-"
            
            Update_1()
        }
        function changeOperatorPlus_1(){
            o1="+"
            Update_1()
        }
        function changeOperator_2(ope){
            o2=ope
            Update_2()
        }
        function Update_1(){
            console.log("update_1")
            document.getElementById("player_1").innerHTML=LP1
            if(p1!=0){
                document.getElementById("player_1").innerHTML+=o1+p1;
            }
            if(o1=="-"){
                document.getElementById("minus_1").disabled=true;
            }else{
                document.getElementById("minus_1").disabled=false;
            }
            if(o1=="+"){
                document.getElementById("plus_1").disabled=true;
            }else{
                document.getElementById("plus_1").disabled=false;
            }
        }
        function Update_2(){
            console.log("update_2")
            document.getElementById("player_2").innerHTML=LP2
            if(p2!=0){
                document.getElementById("player_2").innerHTML+=o2+p2;
            } 
            if(o2=="-"){
                document.getElementById("minus_2").disabled=true;
            }else{
                document.getElementById("minus_2").disabled=false;
            }
            if(o2=="+"){
                document.getElementById("plus_2").disabled=true;
            }else{
                document.getElementById("plus_2").disabled=false;
            }
        }
        function sendData() {
            ws.send(JSON.stringify({type:"calculate",operator:"+"}))
          }
          function sendData_1() {
            ws.send(JSON.stringify({type:"calculate",id:1,operator:o1,LP:p1}))
          }
          function sendData_2(){
            ws.send(JSON.stringify({type:"calculate",id:2,operator:o2,LP:p2}))
          }
          function enterEqual_1(){
            ws.send(JSON.stringify({type:"calculate",id:1,operator:o1,LP:p1}))
          }
          function enterEqual_2(){
            ws.send(JSON.stringify({type:"calculate",id:2,operator:o2,LP:p2}))
          }
          function dice_1(){

          }
          function dice_2(){

          }
          function coin_1(){

          }
          function coin_2(){
            
          }
    </script>
</body>